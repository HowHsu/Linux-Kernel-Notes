```c



                            +-------------------------+      +-------------------------+         +-------------------------+
     file_systems---------->| struct file_system_type |----->| struct file_system_type |-------->| struct file_system_type |<-----------+                                                                                                +-------------------------+                                                         +-------------------------+
                  +-------->+-------------------------+      +-------------------------+         +-------------------------+            |                                                                                                |    struct gendisk       |                                                         |    struct gendisk       |
                  |         |      name = "ext4"      |      |      name = "proc"      |         |      name = "bdev"      |            |                                                                                                +-------------------------+                                                         +-------------------------+
    +-------------+         |      fs_flags           |      |      fs_flags           |         |      fs_flags           |            |                                                                                                |      major              |                                                         |      major              |
    |                       |                         |      |                         |         |                         |            |                                                                                                |      first_minor        |                                                         |      first_minor        |
    |                       |                         |      |                         |         |                         |            |                                                                                                |      minors             |                                                         |      minors             |
    |                       |                         |      |                         |         |                         |            |                                                                                                |      disk_name = "sda"  |                                                         |      disk_name = "sdb"  |
    |                       |                         |      |                         |         |                         |            |                                                                                        +-------|      part0              |                                                  +------|      part0              |
    |                       |                         |      |                         |         |                         |            |                                                                                        |       |      queue              |                                                  |      |      queue              |
    |                       |                         |      |                         |         |                         |            |                                                                                        |       |                         |                                                  |      |                         |
    |                       |                         |      |                         |         |                         |            |                                                                                        |       |                         |                                                  |      |                         |
    |                       |        ......           |      |        ......           |         |        ......           |            |                                                                                        |       |                         |                                                  |      |                         |
    |                       +-------------------------+      +-------------------------+         +-------------------------+            |                                                                                        |       |      ......             |                                                  |      |      ......             |
    |                                                                                                                                   |                                                                                        |       +-------------------------+                                                  |      +-------------------------+
    |                                                                                                                                   |                                                                                        |                 ^                                                                  |                           ^
    |                                                                                                                                   |      +-------------------------------------------+                                     |                 |                                                                  |                           |
    |                                                                                                                                   |      |  struct super_block //blockdev_superblock |<-----+---------------------------------------------------+---------------------------------------------+                 |                           |
    |                                                                                                                                   |      +-------------------------------------------+      |                              |                 |  |                                             |                 |                           |
    |                                      +-------------------------+      +-------------------------+   +-------------------------+   |      |      s_mounts // is NULL?                 |      |                              |                 |  |                                             |                 |                           |
  +--------------------------------------->|     struct mount        |      |     struct mount        |   |     struct mount        |   +------|      s_type                               |      |                              |                 |  |                                             |                 |                           |
  | |                                      +-------------------------+      +-------------------------+   +-------------------------+          |                                           |      |                              |                 |  |                                             |                 |                           |
  | |                                      | +---------------------+ |      | +---------------------+ |   | +---------------------+ |          |                                           |      |                              |                 |  |                                             |                 |                           |
  | |                                      | | struct vfsmount mnt | |      | | struct vfsmount mnt | |   | | struct vfsmount mnt | |          |                                           |      |                              |                 |  |                                             |                 |                           |
  | |                                      | +---------------------+ |      | +---------------------+ |   | +---------------------+ |          |                                           |      |                              |                 |  |                                             |                 |                           |
  | |                                      | |       mnt_root      |-|--+   | |       mnt_root      | |   | |       mnt_root      | |          |                                           |      |                              V                 |  |                                             |                 V                           |
  | |                +---------------------|-|        mnt_sb       | |  |   | |        mnt_sb       | |   | |        mnt_sb       | |          |                                           |      |         +------------------------------------+ |  |   +------------------------------------+    |     +------------------------------------+  |
  | |                |                     | +---------------------+ |  |   | +---------------------+ |   | +---------------------+ |          |       s_root                              |      |         |     struct bdev_inode              | |  |   |     struct bdev_inode              |    |     |     struct bdev_inode              |  |
  | |                |                     |      mnt_mountpoint     |  |   |                         |   |                         |          |       ......                              |      |         +------------------------------------+ |  |   +------------------------------------+    |     +------------------------------------+  |
  | |                |             +------>|      mnt_instance       |----->|      mnt_instance       |-->|      mnt_instance       |          +-------------------------------------------+      |         | +--------------------------------+ | |  |   | +--------------------------------+ |    |     | +--------------------------------+ |  |
  | |                |             |       |      mnt_parent         |  |   |                         |   |                         |                                                             |         | | struct block_device bdev       | | |  |   | | struct block_device bdev       | |    |     | | struct block_device bdev       | |  |
  | |                |             |       +-------------------------+  |   +-------------------------+   +-------------------------+                                                             |         | +--------------------------------+ | |  |   | +--------------------------------+ |    |     | +--------------------------------+ |  |
  | |                |             |                                    |                                                                                                                         |         | | bd_start_sect                  | | |  |   | | bd_start_sect                  | |    |     | | bd_start_sect                  | |  |
  | |                |             |                                    |                                                                                                                         |         | | bd_nr_sectors                  | | |  |   | | bd_nr_sectors                  | |    |     | | bd_nr_sectors                  | |  |
  | |                |             |                                    |                                                                                                                         |         | | dev_t       bd_dev             | | |  |   | | dev_t       bd_dev             | |    |     | | dev_t       bd_dev             | |  |
  | |                |             |                                    |                                                                                                                         |         | | bd_inode                       | | |  |   | | bd_inode                       | |    |     | | bd_inode                       | |  |
  | |                V             |                                    |                                                                                                                         +---------|-| bd_super                       | | |  +---|-| bd_super                       | |    +-----|-| bd_super                       | |  |
  | |  +----------------------+    |                                    |                                                                                                                                   | | struct device  bd_device       | | |      | | struct device  bd_device       | |          | | struct device  bd_device       | |  |
  | |  |  struct super_block  |    |                                    |                                                                                                                                   | | bd_partno = 0                  | | |      | | bd_partno = 1                  | |          | | bd_partno = 0                  | |  |
  | |  +----------------------+    |                                    |                                                                                                                                   | | bd_disk                        |-|-+------|-| bd_disk                        | |          | | bd_disk                        |-|--+
  | |  |      s_mounts        | ---+               +--------------------+                                                                                                                                   | | struct request_queue *bd_queue | |        | | struct request_queue *bd_queue | |          | | struct request_queue *bd_queue | |
  | +--|      s_type          |                    |                                                                                                                                                        | +--------------------------------+ |        | +--------------------------------+ |          | +--------------------------------+ |
  |    |                      |                    |                                                                                                                                                        |                                    |        |                                    |          |                                    |
  |    |                      |                    |                                                                                                                                                        |  +----------------------------+    |        |  +----------------------------+    |          |  +----------------------------+    |
  |    |                      |                    |                                                                                                           inode_hashtable(icache)----------------------|->|            inode           |    |------->|  |            inode           |    |--------->|  |            inode           |    |
  |    |                      |                    |                                                                                                                                                        |  +----------------------------+    |        |  +----------------------------+    |          |  +----------------------------+    |
  |    |                      |                    V                                                                                                                                             ...equal...|.>|  i_ino                     |    |   .....|.>|  i_ino                     |    |     .....|.>|  i_ino                     |    |
  |    |                      |       +----------------------+                                                                                                                                   .          |  |                            |    |   .    |  |                            |    |     .    |  |                            |    |
  |    |       s_root         | ----> |       dentry /       | <--------dh------ dentry_hashtable(dcache)                                                                                        .          |  +----------------------------+    |   .    |  +----------------------------+    |     .    |  +----------------------------+    |
  |    |       ......         |       +----------------------+                                                                                                                                   .          +------------------------------------+   .    +------------------------------------+     .    +------------------------------------+
  |    +----------------------+       | d_name = {hash, ''}  |                                                                                                                                   .                                                   .                                               .
  |         ^                         | d_parent             |                                                                                                                                   . hash(sb, i_rdev) as key to look for       ..equal..                               ......equal......
  |         |                         | d_inode = inode_/(2) |                                                                                                                                   . bdev inode in icache                      .                                       .
  |         |                         | d_sb                 |                                                                                                                                   .                                           .                                       .
  |         |                         | d_child              |                                                                                                                                   .     +----------------------------+        .   +----------------------------+      .    +----------------------------+
  |         |    +------------------- | d_subdirs            |                                                                                                                                   .     |            inode           |        .   |            inode           |      .    |            inode           |
  |         |    |                    +----------------------+                                                                                                                                   .     +----------------------------+        .   +----------------------------+      .    +----------------------------+
  |         |    |                               |                                                                                                                                               .     |  i_mode //S_ISBLK() = true |        .   |  i_mode //S_ISBLK() = true |      .    |  i_mode //S_ISBLK() = true |
  |         |    |                      +---dh---+                                                                                                                                               ......|..dev_t i_rdev              |        ....|..dev_t i_rdev              |      .....|..dev_t i_rdev              |
  |         |    |                      V                                                                                                                                                              |  i_ino // inode number     |            |  i_ino // inode number     |           |  i_ino // inode number     |
  |         |    |         +--------------------------+    +------------------------+     +------------------------+          +------------------------+                                               |  i_size = 0                |            |  i_size = 0                |           |  i_size = 0                |
  |         |    |         |       dentry a           |-dh>|       dentry usr       | --> |       dentry var       | ---+     |       dentry dev       |                                               |                            |            |                            |           |                            |
  |         |    |         +--------------------------+    +------------------------+     +------------------------+    |     +------------------------+                                               |                            |            |                            |           |                            |
  |         |    |         | d_name = {hash, 'a'}     |    | d_name = {hash, 'usr'} |     | d_name = {hash, 'var'} |    |     | d_name = {hash, 'var'} |                                               +----------------------------+            +----------------------------+           +----------------------------+
  |         |    |         | d_parent = dentry /      |    | d_parent = dentry /    |     | d_parent = dentry /    |    |     | d_parent = dentry /    |                                                        ^                                                ^                                           ^
  |         |    |         | d_inode = inode_a        |    | d_inode = inode_usr    |     | d_inode = inode_var    |    |     | d_inode = inode_var    |                                                        |                                                |                                           |
  |         +------------- | d_sb                     |    | d_sb                   |     | d_sb                   |    |     | d_sb                   |                                                        |                                                |                                           |
  |              +-------> | d_child                  |--> | d_child                | --> | d_child                |--------->| d_child                |                                                        |                                                |                                           |
  |                        | d_subdirs                |-+  | d_subdirs              |     | d_subdirs              |    |  +--| d_subdirs              |                                                        |                                                |                                           |
  |                        | d_flags |= DCACHE_MOUNTED| |  +------------------------+     +------------------------+    d  |  +------------------------+                                                        |                                                |                                           |
  |                        +--------------------------+ |                                                               h  |                                                                                    |                                                |                                           |
  |                                  ^                  |                                                               |  |                                                                                    |                                                |                                           |
  |                                  |                  |                                                               |  |                                                                                    |                                                |                                           |
  |                                  |                  |  +----------------------+       +----------------------+      |  |                                             +------------------------------+       |        +------------------------------+        |        +------------------------------+   |
  |                                  |          +--------- |       dentry b       | <-dh- |       dentry x       | <----+  |                                             |       dentry sda1            |       |        |       dentry sda2            |        |        |       dentry sdb             |   |
  |                                  |          |       |  +----------------------+       +----------------------+         |                                             +------------------------------+       |        +------------------------------+        |        +------------------------------+   |
  |                                  |          |       |  | d_name = {hash, 'b'} |       | d_name = {hash, 'x'} |         |                                             | d_name = {hash, '/dev/sda1'} |       |        | d_name = {hash, '/dev/sda2'} |        |        | d_name = {hash, '/dev/sdb'}  |   |
  |                                  |          |       |  | d_parent = dentry a  |       | d_parent = dentry a  |         |                                             | d_parent = dentry /dev/sda1  |       |        | d_parent = dentry /dev/sda2  |        |        | d_parent = dentry /dev/sdb   |   |
  |                                  |          |       |  | d_inode = inode_b    |       | d_inode = inode_x    |         |                                             | d_inode = inode_sda1         |-------+        | d_inode = inode_sda2         |--------+        | d_inode = inode_sdb          |---+
  |                                  |          |       |  | d_sb                 |       | d_sb                 |         |                                             | d_sb                         |                | d_sb                         |                 | d_sb                         |
  |                                  |          |       +->| d_child              | ----> | d_child              |         +-------------------------------------------->| d_child                      |--------------->| d_child                      |---------------->| d_child                      |
  |                                  |          |          | d_subdirs            | --+   | d_subdirs            |                                                       | d_subdirs                    |                | d_subdirs                    |                 | d_subdirs                    |
  |                                  |          |          +----------------------+   |   +----------------------+                                                       +------------------------------+                +------------------------------+                 +------------------------------+
  |                                  |          |                                     |
  |                                  |          |                                     |
  |                                  |          |                                     |     +----------------------+         +----------------------+
  |                                  |          +-------------------dh--------------------> |       dentry c       | --dh--> |       dentry y       |
  |                                  |                                                |     +----------------------+         +----------------------+
  |                                  |                                                |     | d_name = {hash, 'c'} |         | d_name = {hash, 'y'} |
  |                                  |                                                |     | d_parent = dentry b  |         | d_parent = dentry b  |
  |                                  |                                                |     | d_inode = inode_c    |         | d_inode = inode_y    |
  |                                  |                                                |     | d_sb                 |         | d_sb                 |
  |                                  |                                                +---> | d_child              |  ---->  | d_child              |
  |                                  |                                                      | d_subdirs            |         | d_subdirs            |
  |                                  |                                                      +----------------------+         +----------------------+
  |                                  |
  |                                  |
  |                                  |
  |                                  |
  |                                  |
  |                                  |
  |                                  |
  |                                  |    +-------------------------+
  |                                  |    |     struct mount        |
  |                                  |    +-------------------------+
  |                                  |    | +---------------------+ |
  |                                  |    | | struct vfsmount mnt | |
  |                                  |    | +---------------------+ |
  |                                  |    | |       mnt_root      |-|--+
  |                 +---------------------|-|        mnt_sb       | |  |
  |                 |                |    | +---------------------+ |  |
  |                 |                |    |                         |  |
  |                 |             +------>|      mnt_instance       |  |
  |                 |             |  |    |                         |  |
  |                 |             |  +----|       mnt_mountpoint    |  |
  |                 |             |       |                         |  |
  +---------------------------------------|       mnt_parent        |  |
                    |             |       |                         |  |
                    |             |       +-------------------------+  |
                    |             |                                    |
                    |             |                                    |
                    V             |                                    |
      +----------------------+    |                                    |
      |  struct super_block  |    |                                    |
      +----------------------+    |                                    |
      |      s_mounts        | ---+               +--------------------+
      |                      |                    |
      |                      |                    |
      |                      |                    |
      |                      |                    |
      |                      |                    |
      |                      |                    V
      |                      |       +----------------------+
      |       s_root         | ----> |       dentry /       |
      |       s_bdev         |       +----------------------+
      +----------------------+       | d_name = {hash, ''}  |
                                     | d_parent             |
                                     | d_inode = inode_/    |
                                     | d_sb                 |
                                     | d_child              |
                                     | d_subdirs            |
                                     +----------------------+

```
